{
  "name": "run-query",
  "description": "Executes a query in Metabase. A query is composed from multiple steps",
  "parameters": {
    "type": "object",
    "properties": {
      "steps": {
        "type": "array",
        "description": "List of query steps.",
        "items": {
          "anyOf": [
            {
              "type": "object",
              "description": "Filter query results by a string column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the string filter step.",
                  "enum": [
                    "string-filter"
                  ]
                },
                "column": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "Name of the string column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "String filter operator.",
                  "enum": [
                    "=",
                    "!=",
                    "contains",
                    "does-not-contain",
                    "starts-with",
                    "ends-with"
                  ]
                },
                "value": {
                  "type": "string",
                  "description": "String filter value."
                }
              },
              "required": [
                "type",
                "column",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a numeric column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the number filter step.",
                  "enum": [
                    "number-filter"
                  ]
                },
                "column": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "Name of the numeric column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "Numeric filter operator.",
                  "enum": [
                    "=",
                    "!=",
                    ">",
                    ">=",
                    "<",
                    "<="
                  ]
                },
                "value": {
                  "type": "number",
                  "description": "Numeric filter value."
                }
              },
              "required": [
                "type",
                "column",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a boolean column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the boolean filter step.",
                  "enum": [
                    "boolean-filter"
                  ]
                },
                "column": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "Name of the boolean column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "Boolean filter operator.",
                  "enum": [
                    "="
                  ]
                },
                "value": {
                  "type": "boolean",
                  "description": "Boolean filter value."
                }
              },
              "required": [
                "type",
                "column",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a date column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the date filter step.",
                  "enum": [
                    "date-filter"
                  ]
                },
                "column": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "Name of the date column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "Date filter operator.",
                  "enum": [
                    "=",
                    ">",
                    "<"
                  ]
                },
                "value": {
                  "type": "string",
                  "description": "Date filter value. Must be a date in ISO 8601 format."
                }
              },
              "required": [
                "type",
                "column",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Aggregate query results.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the aggregation step.",
                  "enum": [
                    "aggregation"
                  ]
                },
                "operator": {
                  "type": "string",
                  "description": "Aggregation operator.",
                  "enum": [
                    "count",
                    "sum",
                    "avg",
                    "distinct",
                    "cum-sum",
                    "cum-count",
                    "stddev",
                    "min",
                    "max"
                  ]
                },
                "column": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "Optional column name for the selected aggregation operator. If not specified, set it to null."
                }
              },
              "required": [
                "type",
                "operator",
                "column"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Group by, or breakout, query results.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the breakout step.",
                  "enum": [
                    "breakout"
                  ]
                },
                "column": {
                  "type": "string",
                  "description": "Name of the column to apply grouping for."
                }
              },
              "required": [
                "type",
                "column"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Sort the query results.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the order by step.",
                  "enum": [
                    "order_by"
                  ]
                },
                "column": {
                  "type": "string",
                  "description": "Name of the column to apply sorting for."
                }
              },
              "required": [
                "type",
                "column"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Set the row limit for the query.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the row limit step.",
                  "enum": [
                    "limit"
                  ]
                },
                "limit": {
                  "type": "number",
                  "description": "Row limit."
                }
              },
              "required": [
                "type",
                "limit"
              ],
              "additionalProperties": false
            }
          ]
        }
      }
    },
    "required": [
      "steps"
    ],
    "additionalProperties": false
  }
}
